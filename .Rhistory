rse <- sum((y.vec - as.numeric(X %*% betas))^2)/(ss - 2)
est <- c(betas[2], betas[2]/sqrt(XTXinv[2, 2] * rse))
}else{
est <- cors[max.k - 1] / sd(data[, max.k])
}
return(est)
}
find_max_cor_beta_2(mvrnorm(n = 100, mu = rep(0, 10), diag(10) + 1))
cors.2
cors
t(cors)
cor(data)[-1, 1]
find_max_cor_beta_2 <- function(data, find_sd = FALSE){
covs <- ncol(data) - 1
ss <- nrow(data)
s.data <- data - rep(colMeans(data), each = ss)
s.data <- s.data / rep(sqrt(colSums(s.data^2)), each = ss)
cors <- crossprod(s.data[, -1], s.data[, 1])
max.k <- which.max(abs(cors)) + 1
if(find_sd == TRUE){
TX <- rbind(1, data[, max.k])
X <- t(TX)
XTXinv <- solve(TX %*% X)
betas <- XTXinv %*% TX %*% y.vec
rse <- sum((y.vec - as.numeric(X %*% betas))^2)/(ss - 2)
est <- c(betas[2], betas[2]/sqrt(XTXinv[2, 2] * rse))
}else{
est <- cors[max.k - 1] / sd(data[, max.k])
}
return(est)
}
find_max_cor_beta_2(mvrnorm(n = 100, mu = rep(0, 10), diag(10) + 1))
for(i in 1:1000){}
for(i in 1:1000){
gg <- find_max_cor_beta_2(mvrnorm(n = 100, mu = rep(0, 10), diag(10) + 1))
}
for(i in 1:1000){
gg <- find_max_cor_beta(mvrnorm(n = 100, mu = rep(0, 10), diag(10) + 1))
}
for(i in 1:10000){
gg <- find_max_cor_beta_2(mvrnorm(n = 100, mu = rep(0, 10), diag(10) + 1))
}
for(i in 1:10000){
gg <- find_max_cor_beta(mvrnorm(n = 100, mu = rep(0, 10), diag(10) + 1))
}
for(i in 1:1000){
gg <- find_max_cor_beta(mvrnorm(n = 100, mu = rep(0, 200), diag(10) + 1))
}
for(i in 1:1000){
gg <- find_max_cor_beta(mvrnorm(n = 100, mu = rep(0, 200), diag(200)))
}
for(i in 1:1000){
gg <- find_max_cor_beta_2(mvrnorm(n = 100, mu = rep(0, 200), diag(200)))
}
find_max_cor_beta_2 <- function(data, find_sd = FALSE){
covs <- ncol(data) - 1
ss <- nrow(data)
s.data <- data - rep(colMeans(data), each = ss)
s.data <- s.data / rep(sqrt(colSums(s.data^2)), each = ss)
cors <- crossprod(s.data[, -1], s.data[, 1])
max.k <- which.max(abs(cors)) + 1
if(find_sd == TRUE){
TX <- rbind(1, data[, max.k])
X <- t(TX)
XTXinv <- solve(TX %*% X)
betas <- XTXinv %*% TX %*% y.vec
rse <- sum((y.vec - as.numeric(X %*% betas))^2)/(ss - 2)
est <- c(betas[2], betas[2]/sqrt(XTXinv[2, 2] * rse))
}else{
est <- cors[max.k - 1] / sd(data[, max.k])
}
return(est)
}
for(i in 1:1000){ gg <- find_max_cor_beta_2(mvrnorm(n = 100, mu = rep(0, 200), diag(200) + 1))}
for(i in 1:1000){ gg <- mvrnorm(n = 100, mu = rep(0, 200), diag(200) + 1)
)
for(i in 1:1000){ gg <- mvrnorm(n = 100, mu = rep(0, 200), diag(200) + 1)}
bb <-
bb <- mvrnorm(n = 100, mu = rep(0, 200), diag(200) + 1)
for(i in 1:1000){ gg <- bb[sample(100, replace = TRUE), ]}
for(i in 1:1000){ gg <- find_max_cor_beta_2(bb[sample(100, replace = TRUE), ])}
for(i in 1:1000){ gg <- find_max_cor_beta(bb[sample(100, replace = TRUE), ])}
for(i in 1:10000){ gg <- find_max_cor_beta(bb[sample(100, replace = TRUE), ])}
for(i in 1:10000){ gg <- find_max_cor_beta_2(bb[sample(100, replace = TRUE), ])}
for(i in 1:1000){ gg <- find_max_cor_beta_2(bb[sample(100, replace = TRUE), ])}
for(i in 1:1000){ gg <- find_max_cor_beta_2(bb[sample(100, replace = TRUE), ])}
mean(2, 3)
mean(c(2, 3))
cumsum(c(1, 2, 3))
a <- c(1, 0, 0, 1, 0, 0, 1, 1, 1, 1)
b <- c(0, 0, 1, 0, 0, 0, 0, 1, 0, 0)
c <- a - b
cumsum(c(sum(a), c))
c
cumsum(c(sum(b), c))
rnorm(1)
4 < inf
4 < infinity
c <- 1:10
source("ART.R")
source("bbV.R")
source("findlambda.R")
setwd("~/Dropbox/School_UW/2017-2018/Spring 2018/BIOSTAT572/SimulationStudy/BIOSTAT572R")
################################################
#### This script is written to gives to find run
#### simulations after being called by a script
#### command.
################################################
################################################
#### Author : Adam Elder
################################################
################################################
setwd("~/Dropbox/School_UW/2017-2018/Spring 2018/BIOSTAT572/SimulationStudy/BIOSTAT572R")
source("ART.R")
source("bbV.R")
source("findlambda.R")
source("get_max_beta.R")
source("Sim_Study.R")
source("Simulate_1.R")
source("sortlambda.R")
source("Testing.R")
gen.data <- function(ss, local, covs){
x <- mvrnorm(n = ss, mu = rep(0, covs), Sigma = diag(covs) )
true.beta <- c(local/sqrt(ss), rep(0, covs - length(local)))
y <- rnorm(ss, sd = 1) + x %*% true.beta
return(data.frame("y" = y, "x" = x))
}
gen_est <- function(ss, local, covs){
obs_data <- gen.data(ss, local, covs)
return(find_max_cor_beta(obs_data), find_sd = FALSE)
}
ests <- mvrnorm(n = sims, mu = rep(0, covs), Sigma = diag(covs))
gen_limit_distr <- function(sims, local, covs){
ests <- mvrnorm(n = sims, mu = rep(0, covs), Sigma = diag(covs))
distr <- apply(ests, 1, function(x){x[which.max(x^2)]})
}
gen_limit_distr(10, 0, 10)
gen_limit_distr <- function(sims, covs){
ests <- mvrnorm(n = sims, mu = rep(0, covs), Sigma = diag(covs))
distr <- apply(ests, 1, function(x){x[which.max(x^2)]})
return(distr)
}
gen_limit_distr(10, 10)
gen_limit_distr(10, 10)
gen_limit_distr(10, 10)
hist(gen_limit_distr(1000, 10))
find_distr_null(sims, ss, covs){
distr <- rep(NA, sims)
for(i in 1:sims){
distr[i] <- gen_est(ss, 0, covs)
}
return(distr)
}
find_distr_null <- function(sims, ss, covs){
distr <- rep(NA, sims)
for(i in 1:sims){
distr[i] <- gen_est(ss, 0, covs)
}
return(distr)
}
find_distr_null(10, 100, 10)
gen_est(10, 0, 10)
gen_est(10, c(0), 10)
gen_est <- function(ss, local, covs){
obs_data <- gen.data(ss, local, covs)
return(find_max_cor_beta(obs_data, find_sd = FALSE))
}
gen_est(10, c(0), 10)
gen_est(10, c(0, 0), 10)
gen_est(100, c(0, 0), 10)
gen.data(10, 0, 10)
gen_est(10, c(0, 0), 10)
gen_est(100, c(0, 0), 10)
gen_est(100, c(0, 0), 10)
find_max_cor_beta(mvrnorm(n = 10, mu = rep(0, 5), Sigma = diag(5)))
find_max_cor_beta(mvrnorm(n = 10, mu = rep(0, 5), Sigma = diag(5)))
find_max_cor_beta(mvrnorm(n = 10, mu = rep(0, 5), Sigma = diag(5)))
find_max_cor_beta(mvrnorm(n = 10, mu = rep(0, 5), Sigma = diag(5)))
find_max_cor_beta(mvrnorm(n = 10, mu = rep(0, 5), Sigma = diag(5)), find_sd = FALSE)
find_max_cor_beta(mvrnorm(n = 10, mu = rep(0, 5), Sigma = diag(5)), find_sd = FALSE)
find_max_cor_beta(mvrnorm(n = 10, mu = rep(0, 5), Sigma = diag(5)), find_sd = FALSE)
find_max_cor_beta(mvrnorm(n = 10, mu = rep(0, 5), Sigma = diag(5)), find_sd = FALSE)
gen_est(10, c(0, 0), 10)
gen_est <- function(ss, local, covs){
obs_data <- gen.data(ss, local, covs)
browser()
return(find_max_cor_beta(obs_data, find_sd = FALSE))
}
gen_est(10, c(0, 0), 10)
gen.data <- function(ss, local, covs){
x <- mvrnorm(n = ss, mu = rep(0, covs), Sigma = diag(covs) )
true.beta <- c(local/sqrt(ss), rep(0, covs - length(local)))
y <- rnorm(ss, sd = 1) + x %*% true.beta
return(cbind("y" = y, "x" = x))
}
gen.data <- function(ss, local, covs){
x <- mvrnorm(n = ss, mu = rep(0, covs), Sigma = diag(covs) )
true.beta <- c(local/sqrt(ss), rep(0, covs - length(local)))
y <- rnorm(ss, sd = 1) + x %*% true.beta
return(cbind("y" = y, "x" = x))
}
gen_est <- function(ss, local, covs){
obs_data <- gen.data(ss, local, covs)
browser()
return(find_max_cor_beta(obs_data, find_sd = FALSE))
}
gen_est(10, c(0, 0), 10)
gen_est <- function(ss, local, covs){
obs_data <- gen.data(ss, local, covs)
return(find_max_cor_beta(obs_data, find_sd = FALSE))
}
find_distr_null <- function(sims, ss, covs){
distr <- rep(NA, sims)
for(i in 1:sims){
distr[i] <- sqrt(ss) * gen_est(ss, 0, covs)
}
return(distr)
}
find_distr_null(10, 100, 10)
find_distr_null(10, 100, 10)
find_distr_null(10, 100, 10)
sample_null <- find_distr_null(10000, 10, 10)
limit_null <- gen_limit_distr(10000, 10)
hist(sample_null)
hist(limit_null)
sample_null <- find_distr_null(1000, 10,0 10)
sample_null <- find_distr_null(1000, 100, 10)
hist(sample_null)
qqplot(sample_null, limit_null)
qqplot(sample_null, limit_null, "l")
qqplot(sample_null, limit_null, type = "l")
sample_null <- find_distr_null(1000, 1000, 10)
qqplot(sample_null, limit_null, type = "l")
sample_null <- find_distr_null(1000, 10000, 10)
qqplot(sample_null, limit_null, type = "l")
abline(0, 1)
abline(0, 1, col = "red")
sample_null <- find_distr_null(1000, 100000, 10)
qqplot(sample_null, limit_null, type = "l")
make_some_plots_3 <- function(sample_size, sims, covs){
limit_distr <-  gen_limit_distr(sims = sims, covs = covs)
sample_distr <- find_distr_null(sims = sims, ss = sample_size, covs = covs)
dat <- data.frame("val" = c(null_sample_distr, sample_distr),
"Generation Method" = rep(c( "Local Sample", "Null Sample"), each = sims))
dat <- subset(dat, val <= 5 & -7.5 <= val)
A <- ggplot(dat, aes(x = val, fill = Generation.Method)) +
scale_fill_discrete(name = "Generation Method : ",
labels = c("Null Sampling Distribution", "Local Sampling Distribution")) +
geom_density(alpha = .5, position="identity") +
labs(x = "\n Beta", y = "\n Density") + xlim(c(-7.5 , 5)) + ylim(c(0.0, 0.45)) +
theme_minimal() + theme(legend.position="top", text = element_text(size=20))
A
}
make_some_plots_3(100, 100, 10)
make_some_plots_3 <- function(sample_size, sims, covs){
limit_distr <-  gen_limit_distr(sims = sims, covs = covs)
sample_distr <- find_distr_null(sims = sims, ss = sample_size, covs = covs)
dat <- data.frame("val" = c(limit_distr, sample_distr),
"Generation Method" = rep(c( "Limiting Distribution", "Sampling Distribution"), each = sims))
dat <- subset(dat, val <= 5 & -7.5 <= val)
A <- ggplot(dat, aes(x = val, fill = Generation.Method)) +
scale_fill_discrete(name = "Generation Method : ",
labels = c("Null Sampling Distribution", "Local Sampling Distribution")) +
geom_density(alpha = .5, position="identity") +
labs(x = "\n Beta", y = "\n Density") + xlim(c(-7.5 , 5)) + ylim(c(0.0, 0.45)) +
theme_minimal() + theme(legend.position="top", text = element_text(size=20))
A
}
make_some_plots_3(100, 100, 10)
library(gglp)
library(ggplot2)
make_some_plots_3(100, 100, 10)
make_some_plots_3(1000, 100, 10)
make_some_plots_3 <- function(sample_size, sims, covs){
limit_distr <-  gen_limit_distr(sims = sims, covs = covs)
sample_distr <- find_distr_null(sims = sims, ss = sample_size, covs = covs)
dat <- data.frame("val" = c(limit_distr, sample_distr),
"Generation Method" = rep(c( "Limiting Distribution", "Sampling Distribution"), each = sims))
dat <- subset(dat, val <= 5 & -7.5 <= val)
A <- ggplot(dat, aes(x = val, fill = Generation.Method)) +
scale_fill_discrete(name = "Generation Method : ",
labels = c("Limiting Distribution", "Sampling Distribution")) +
geom_density(alpha = .5, position="identity") +
labs(x = "\n Beta", y = "\n Density") + xlim(c(-7.5 , 5)) + ylim(c(0.0, 0.45)) +
theme_minimal() + theme(legend.position="top", text = element_text(size=20))
A
}
make_some_plots_3 <- function(sample_size, sims, covs){
limit_distr <-  gen_limit_distr(sims = sims, covs = covs)
sample_distr <- find_distr_null(sims = sims, ss = sample_size, covs = covs)
dat <- data.frame("val" = c(limit_distr, sample_distr),
"Generation Method" = rep(c( "Limiting Distribution", "Sampling Distribution"), each = sims))
dat <- subset(dat, val <= 5 & -7.5 <= val)
A <- ggplot(dat, aes(x = val, fill = Generation.Method)) +
scale_fill_discrete(name = "Generation Method : ",
labels = c("Limiting Distribution", "Sampling Distribution")) +
geom_density(alpha = .5, position="identity") +
labs(x = "\n Beta", y = "\n Density") + xlim(c(-7.5 , 5)) + ylim(c(0.0, 0.45)) +
theme_minimal() + theme(legend.position="top", text = element_text(size=20))
A
}
make_some_plots_3(1000, 1000, 10)
make_some_plots_3(10000, 1000, 10)
make_some_plots_3(100000, 1000, 10)
make_some_plots_3 <- function(sample_size, sims, covs){
limit_distr <-  gen_limit_distr(sims = sims, covs = covs)
sample_distr <- find_distr_null(sims = sims, ss = sample_size, covs = covs)
dat <- data.frame("val" = c(limit_distr, sample_distr),
"Generation Method" = rep(c( "Limiting Distribution", "Sampling Distribution"), each = sims))
dat <- subset(dat, val <= 5 & -5 <= val)
A <- ggplot(dat, aes(x = val, fill = Generation.Method)) +
scale_fill_discrete(name = "Generation Method : ",
labels = c("Limiting Distribution", "Sampling Distribution")) +
geom_density(alpha = .5, position="identity") +
labs(x = "\n Beta", y = "\n Density") + xlim(c(-7.5 , 5)) + ylim(c(0.0, 0.45)) +
theme_minimal() + theme(legend.position="top", text = element_text(size=20))
A
}
make_some_plots_3(100000, 1000, 10)
make_some_plots_3 <- function(sample_size, sims, covs){
limit_distr <-  gen_limit_distr(sims = sims, covs = covs)
sample_distr <- find_distr_null(sims = sims, ss = sample_size, covs = covs)
dat <- data.frame("val" = c(limit_distr, sample_distr),
"Generation Method" = rep(c( "Limiting Distribution", "Sampling Distribution"), each = sims))
dat <- subset(dat, val <= 5 & -5 <= val)
A <- ggplot(dat, aes(x = val, fill = Generation.Method)) +
scale_fill_discrete(name = "Generation Method : ",
labels = c("Limiting Distribution", "Sampling Distribution")) +
geom_density(alpha = .5, position="identity") +
labs(x = "\n Beta", y = "\n Density") + xlim(c(-5 , 5)) + ylim(c(0.0, 0.45)) +
theme_minimal() + theme(legend.position="top", text = element_text(size=20))
A
}
make_some_plots_3(100000, 1000, 10)
make_some_plots_3(1000, 10000, 10)
make_some_plots_3(1000, 10000, 100)
make_some_plots_3(100, 10000, 100)
make_some_plots_3(100, 10000, 100)
A <- ggplot(sample_null, aes(x = val))
A <- ggplot(as.data.frame(x = sample_null), aes(x = val))
A + geom_density(alpha = 0.5)
A <- ggplot(as.data.frame(x = sample_null), aes(x = x))
A + geom_density(alpha = 0.5)
bb <- as.data.frame(x = sample_null)
View(bb)
bb <- as.data.frame("x" = sample_null)
View(bb)
names(bb) <- c("x")
View(bb)
A <- ggplot(bb, aes(x = x))
A + geom_density(alpha = 0.5)
A <- ggplot(bb, aes(x = x, fill = "red"))
A + geom_density(alpha = 0.5)
A + geom_density(alpha = 0.5) + theme_void()
A + geom_density(alpha = 0.5) + theme_void() + theme(legend.position="None")
data <- rnorm(1000)
bb$x <- data
A <- ggplot(bb, aes(x = x, fill = "red"))
A <- ggplot(bb, aes(x = x, fill = "blue"))
A + geom_density(alpha = 0.5) + theme_void() + theme(legend.position="None")
data <- rnorm(100000)
bb$x <- data
bb <- as.data.frame(data)
names(bb) <- c("x")
A <- ggplot(bb, aes(x = x, fill = "blue"))
A + geom_density(alpha = 0.5) + theme_void() + theme(legend.position="None")
data <- rnorm(10000000)
bb <- as.data.frame(data)
names(bb) <- c("x")
A <- ggplot(bb, aes(x = x, fill = "blue"))
A + geom_density(alpha = 0.5) + theme_void() + theme(legend.position="None")
data$cat <- c(rep(0, 999999), 1)
View(data)
ss <- c(rep(0, 999999), 1)
ss <- c(rep(0, 99999), 1)
ss <- c(rep(0, 9999999), 1)
data <- data.frame(bb, ss)
View(data)
A <- ggplot(data, aes(x = x, fill = ss))
A + geom_density(alpha = 0.5) + theme_void() + theme(legend.position="None")
data$ss <- as.factor(data$ss)
A <- ggplot(data, aes(x = x, fill = ss))
A + geom_density(alpha = 0.5) + theme_void() + theme(legend.position="None")
ss <- c(0, rep(1, 9999999))
data <- data.frame(bb, ss)
data$ss <- as.factor(data$ss)
A <- ggplot(data, aes(x = x, fill = ss))
A + geom_density(alpha = 0.5) + theme_void() + theme(legend.position="None")
A <- ggplot(data, aes(x = x))
A + geom_density(alpha = 0.5, color='darkblue') + theme_void() + theme(legend.position="None")
A + geom_density(alpha = 0.5, fill='darkblue') + theme_void() + theme(legend.position="None")
data <- c(limit_null, rnorm(10000))
hist(data)
data <- c(limit_null, rnorm(1000))
hist(data)
data <- c(limit_null, rnorm(3000))
hist(data)
A <- ggplot(data, aes(x = x))
data <- data.frame(data)
A <- ggplot(data, aes(x = data))
A + geom_density(alpha = 0.5, fill='purple') + theme_void() + theme(legend.position="None")
################################################
#### This script is written to gives to find run
#### simulations after being called by a script
#### command.
################################################
################################################
#### Author : Adam Elder
################################################
################################################
setwd("~/Dropbox/School_UW/2017-2018/Spring 2018/BIOSTAT572/SimulationStudy/BIOSTAT572R")
################################################
#### This script is written to gives to find run
#### simulations after being called by a script
#### command.
################################################
################################################
#### Author : Adam Elder
################################################
################################################
#setwd("~/Dropbox/School_UW/2017-2018/Spring 2018/BIOSTAT572/SimulationStudy/BIOSTAT572R")
source("ART.R")
source("bbV.R")
source("findlambda.R")
source("get_max_beta.R")
source("Sim_Study.R")
source("Simulate_1.R")
source("sortlambda.R")
source("Testing.R")
library(MASS)
rho <- rep(c(0.8, 0.5, 0), each = 30)
sample_size <- rep(rep(c(100, 200), each = 15), times = 3)
dims <- rep(rep(c(10, 50, 100, 150, 200), each = 3), times = 6)
model <- rep(c(1, 2, 3), times = 30)
simulate_df <- data.frame("rho" = rho, "n" = sample_size,
"dims" = dims, "model" = model)
syst.envr <- as.numeric(Sys.getenv("SGE_TASK_ID"))
if(!is.na(syst.envr)){
job.id <- as.numeric(Sys.getenv("SGE_TASK_ID"))
}else{
cat("No Job ID found, choosing the answer to life the universe and everything \n")
job.id <- 42
}
job.settings <- simulate_df[job.id, ]
cat("Job ID = ", job.id, "simulation Settings : ")
print(job.settings)
results <- simulate(model = job.settings$model,
n     = job.settings$n,
dim   = job.settings$dims,
rho   = job.settings$rho,
sims  = 1,
alpha = 0.05)
write.csv(results, paste0("/simres/n", job.settings$n,
"mod", job.settings$model,
"dim", job.settings$dim,
"rho", job.settings$rho))
job.settings
results <- simulate(model = job.settings$model,
n     = job.settings$n,
dim   = job.settings$dims,
rho   = job.settings$rho,
sims  = 1,
alpha = 0.05)
results <- simulate(model = job.settings$model,
n     = job.settings$n,
dim   = job.settings$dims,
rho   = job.settings$rho,
sims  = 1,
bs    = 500,
alpha = 0.05)
job.settins <- simulate_df[1, ]
job.settings <- simulate_df[1, ]
job.settings
results <- simulate(model = job.settings$model,
n     = job.settings$n,
dim   = job.settings$dims,
rho   = job.settings$rho,
sims  = 1,
bs    = 500,
alpha = 0.05)
write.csv(results, paste0("/simres/n", job.settings$n,
"mod", job.settings$model,
"dim", job.settings$dim,
"rho", job.settings$rho))
write.csv(results, paste0("/simres/n", job.settings$n,
"mod", job.settings$model,
"dim", job.settings$dim,
"rho", job.settings$rho, ".csv"))
getwd()
write.csv(results, paste0("simres/n", job.settings$n,
"mod", job.settings$model,
"dim", job.settings$dim,
"rho", job.settings$rho, ".csv"))
write.csv(results, paste0("simres/n", job.settings$n,
"mod", job.settings$model,
"dim", job.settings$dim,
"rho", job.settings$rho, ".csv"))
View(simulate_df)
job.settings <- simulate_df[2, ]
results <- simulate(model = job.settings$model,
n     = job.settings$n,
dim   = job.settings$dims,
rho   = job.settings$rho,
sims  = 2,
bs    = 500,
alpha = 0.05)
write.csv(results, paste0("simres/n", job.settings$n,
"mod", job.settings$model,
"dim", job.settings$dim,
"rho", job.settings$rho, ".csv"))
simulate_df <- rbind(simulate_df, simulate_df, simulate_df,
simulate_df, simulate_df)
